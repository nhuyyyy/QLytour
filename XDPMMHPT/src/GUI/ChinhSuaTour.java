/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package GUI;

import BUS.ChiTietTourBUS;
import BUS.DiaDiemBUS;
import BUS.GiaTourBUS;
import BUS.LoaiTourBUS;
import BUS.TourBUS;
import DAO.TourDAO;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Vector;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JComboBox;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author xenov
 */
public class ChinhSuaTour extends javax.swing.JFrame {
    
    private ArrayList<DTO.GiaTour> arrayGia;
    private ArrayList<DTO.DiaDiem> arrayDiaDiem;
    DefaultTableModel table;
    DefaultTableModel tableAllDD;
    DefaultTableModel tableChosenDD;
    /**
     * Creates new form ChinhSuaTour
     */
    public ChinhSuaTour(int mt) {
        initComponents();
        setLocationRelativeTo(null);
           hienThiDuLieuTour(mt);
           doDuLieuBangGia(mt);
           doDuLieuLenBangTatCaDD();
           doDuLieuLenBangDiaDiemDaChon(mt);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jDialog1 = new javax.swing.JDialog();
        jDialog2 = new javax.swing.JDialog();
        jLabel1 = new javax.swing.JLabel();
        pInputTour = new javax.swing.JPanel();
        txtMaTour = new javax.swing.JTextField();
        lblMaTour = new javax.swing.JLabel();
        lblMaLoaiTour = new javax.swing.JLabel();
        lblTenTour = new javax.swing.JLabel();
        cbLoaiTour = new javax.swing.JComboBox<>();
        txtTenTour = new javax.swing.JTextField();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jtChosenDD = new javax.swing.JTable();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        jtAllDD = new javax.swing.JTable();
        btnAdd = new javax.swing.JButton();
        btnRemove = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        jButton5 = new javax.swing.JButton();
        jButton6 = new javax.swing.JButton();
        jButton7 = new javax.swing.JButton();
        txtGia = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jdcStart = new com.toedter.calendar.JDateChooser();
        jdcEnd = new com.toedter.calendar.JDateChooser();
        jScrollPane3 = new javax.swing.JScrollPane();
        jt = new javax.swing.JTable();
        jLabel8 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();

        javax.swing.GroupLayout jDialog1Layout = new javax.swing.GroupLayout(jDialog1.getContentPane());
        jDialog1.getContentPane().setLayout(jDialog1Layout);
        jDialog1Layout.setHorizontalGroup(
            jDialog1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 400, Short.MAX_VALUE)
        );
        jDialog1Layout.setVerticalGroup(
            jDialog1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 300, Short.MAX_VALUE)
        );

        javax.swing.GroupLayout jDialog2Layout = new javax.swing.GroupLayout(jDialog2.getContentPane());
        jDialog2.getContentPane().setLayout(jDialog2Layout);
        jDialog2Layout.setHorizontalGroup(
            jDialog2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 400, Short.MAX_VALUE)
        );
        jDialog2Layout.setVerticalGroup(
            jDialog2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 300, Short.MAX_VALUE)
        );

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 24)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(0, 0, 255));
        jLabel1.setText("CHỈNH SỬA TOUR DU LỊCH");
        getContentPane().add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(439, 11, -1, -1));

        pInputTour.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED));

        txtMaTour.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtMaTourActionPerformed(evt);
            }
        });

        lblMaTour.setText("Mã tour");

        lblMaLoaiTour.setText("Loại tour");

        lblTenTour.setText("Tên tour");

        cbLoaiTour.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cbLoaiTour.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbLoaiTourActionPerformed(evt);
            }
        });

        jButton1.setText("Lưu lại");
        jButton1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton1MouseClicked(evt);
            }
        });

        jButton2.setText("Quay lại");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pInputTourLayout = new javax.swing.GroupLayout(pInputTour);
        pInputTour.setLayout(pInputTourLayout);
        pInputTourLayout.setHorizontalGroup(
            pInputTourLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pInputTourLayout.createSequentialGroup()
                .addGap(28, 28, 28)
                .addComponent(lblMaTour)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(txtMaTour, javax.swing.GroupLayout.PREFERRED_SIZE, 77, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(lblMaLoaiTour)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(cbLoaiTour, javax.swing.GroupLayout.PREFERRED_SIZE, 130, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(lblTenTour)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(txtTenTour, javax.swing.GroupLayout.PREFERRED_SIZE, 319, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 319, Short.MAX_VALUE)
                .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 76, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jButton2)
                .addContainerGap())
        );
        pInputTourLayout.setVerticalGroup(
            pInputTourLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pInputTourLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pInputTourLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pInputTourLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jButton2)
                        .addComponent(jButton1))
                    .addGroup(pInputTourLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(lblTenTour)
                        .addComponent(txtTenTour, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(pInputTourLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(txtMaTour, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(lblMaTour)
                        .addComponent(lblMaLoaiTour)
                        .addComponent(cbLoaiTour, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        getContentPane().add(pInputTour, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 51, -1, -1));

        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder("Địa điểm"));

        jtChosenDD.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null},
                {null},
                {null},
                {null}
            },
            new String [] {
                ""
            }
        ));
        jScrollPane1.setViewportView(jtChosenDD);

        jLabel2.setText("Danh sách địa điểm");

        jLabel3.setText("Địa điểm của tour");

        jtAllDD.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null},
                {null},
                {null},
                {null}
            },
            new String [] {
                ""
            }
        ));
        jtAllDD.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jtAllDDMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(jtAllDD);

        btnAdd.setText("=>");
        btnAdd.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnAddMouseClicked(evt);
            }
        });

        btnRemove.setText("<=");
        btnRemove.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnRemoveMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGap(48, 48, 48)
                .addComponent(jLabel2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel3)
                .addGap(66, 66, 66))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 203, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(btnAdd, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(btnRemove, javax.swing.GroupLayout.Alignment.TRAILING))
                .addGap(18, 18, 18)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 203, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(jLabel3))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(btnAdd)
                        .addGap(18, 18, 18)
                        .addComponent(btnRemove)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addContainerGap())
        );

        jPanel1.add(jPanel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(720, 11, -1, 420));

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder("Giá tour"));
        jPanel3.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jButton5.setText("Thêm giá");
        jButton5.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton5MouseClicked(evt);
            }
        });
        jPanel3.add(jButton5, new org.netbeans.lib.awtextra.AbsoluteConstraints(78, 69, -1, -1));

        jButton6.setText("Sửa giá");
        jButton6.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton6MouseClicked(evt);
            }
        });
        jPanel3.add(jButton6, new org.netbeans.lib.awtextra.AbsoluteConstraints(173, 69, -1, -1));

        jButton7.setText("Xóa giá");
        jButton7.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jButton7MouseClicked(evt);
            }
        });
        jPanel3.add(jButton7, new org.netbeans.lib.awtextra.AbsoluteConstraints(260, 69, -1, -1));

        txtGia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtGiaActionPerformed(evt);
            }
        });
        jPanel3.add(txtGia, new org.netbeans.lib.awtextra.AbsoluteConstraints(73, 31, 171, -1));

        jLabel4.setText("Giá tour");
        jPanel3.add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(16, 34, -1, -1));

        jLabel5.setText("Ngày bắt đầu");
        jPanel3.add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(262, 34, -1, -1));

        jLabel6.setText("Ngày kết thúc");
        jPanel3.add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(492, 34, -1, -1));
        jPanel3.add(jdcStart, new org.netbeans.lib.awtextra.AbsoluteConstraints(344, 31, 130, -1));
        jPanel3.add(jdcEnd, new org.netbeans.lib.awtextra.AbsoluteConstraints(568, 31, 130, -1));

        jt.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null}
            },
            new String [] {
                "Giá", "Ngày bắt đầu", "Ngày kết thúc"
            }
        ));
        jt.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jtMouseClicked(evt);
            }
        });
        jScrollPane3.setViewportView(jt);

        jPanel3.add(jScrollPane3, new org.netbeans.lib.awtextra.AbsoluteConstraints(16, 110, 680, 300));

        jPanel1.add(jPanel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 11, 714, 420));

        jLabel8.setIcon(new javax.swing.ImageIcon(getClass().getResource("/3.jpg"))); // NOI18N
        jPanel1.add(jLabel8, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1240, 460));

        getContentPane().add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 108, 1243, 460));

        jLabel7.setIcon(new javax.swing.ImageIcon(getClass().getResource("/3.jpg"))); // NOI18N
        getContentPane().add(jLabel7, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1260, 610));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        // TODO add your handling code here:
        this.setVisible(false);
        Tour tour = new Tour();
        tour.setVisible(true);
    }//GEN-LAST:event_jButton2ActionPerformed

    private void txtMaTourActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtMaTourActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtMaTourActionPerformed

    private void txtGiaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtGiaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtGiaActionPerformed

    private void jtMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jtMouseClicked
        // TODO add your handling code here:
        int i = jt.getSelectedRow();
        if(i>=0) setTextFields(jt.getValueAt(i,0)+"",jt.getValueAt(i,1)+"",jt.getValueAt(i,2)+"");
    }//GEN-LAST:event_jtMouseClicked

    private void jButton5MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jButton5MouseClicked
        // TODO add your handling code here:
        DTO.GiaTour gt = new DTO.GiaTour();
        gt.setMagia(1);
        gt.setMatour(Integer.parseInt(txtMaTour.getText()));
        gt.setGiatien(Double.parseDouble(txtGia.getText()));
        gt.setTgbd(jdcStart.getDate());
        gt.setTgkt(jdcEnd.getDate());
        
        arrayGia.add(gt);
        
        
        Vector head = new Vector();
        head.add((int)gt.getGiatien());
        DateFormat format = new SimpleDateFormat("yyyy-MM-dd");
        head.add(format.format(gt.getTgbd()));
        head.add(format.format(gt.getTgkt()));
        
        table.addRow(head);
        jt.setModel(table);
    }//GEN-LAST:event_jButton5MouseClicked

    private void jButton1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jButton1MouseClicked
        int result = JOptionPane.showConfirmDialog(null, "Xác nhận lưu ?","Xác nhận",JOptionPane.YES_NO_OPTION);
        if(result == JOptionPane.YES_OPTION){
            try {                                      
                // TODO add your handling code here:
                //sua tour
                DTO.Tour tour = new DTO.Tour();
                TourBUS tbus = new TourBUS();
                LoaiTourBUS ltbus = new LoaiTourBUS();
                tour.setMatour(Integer.parseInt(txtMaTour.getText()));
                try {
                    tour.setMaloaitour(ltbus.getMaLoaiTour(cbLoaiTour.getSelectedItem().toString()));
                } catch (Exception ex) {
                    Logger.getLogger(ChinhSuaTour.class.getName()).log(Level.SEVERE, null, ex);
                }
                tour.setTentour(txtTenTour.getText());
                int res = tbus.sua(tour);
                if(res == 0) return;
                //sua gia
                GiaTourBUS gtbus = new GiaTourBUS();
                gtbus.xoaGiaCoMaTour(tour.getMatour());
                if(arrayGia.size() > 0)
                    gtbus.themAutoPrimaryKey(arrayGia);
                //sua dia diem
                ChiTietTourBUS cttbus = new ChiTietTourBUS();
                cttbus.docDuLieu();
                cttbus.xoaChiTietTourCoMaTour(tour.getMatour());
                if(arrayDiaDiem.size() > 0)
                    cttbus.themAutoPrimaryKey(tour.getMatour(), arrayDiaDiem);
            } catch (Exception ex) {
                Logger.getLogger(ChinhSuaTour.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }//GEN-LAST:event_jButton1MouseClicked

    private void jButton6MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jButton6MouseClicked
        // TODO add your handling code here:
        int i = jt.getSelectedRow();
        if(i >= 0)
        {
            DTO.GiaTour gt = new DTO.GiaTour();
            gt.setMagia(1);
            gt.setMatour(Integer.parseInt(txtMaTour.getText()));
            gt.setGiatien(Double.parseDouble(txtGia.getText()));
            gt.setTgbd(jdcStart.getDate());
            gt.setTgkt(jdcEnd.getDate());

            arrayGia.set(i,gt);
            
            DateFormat format = new SimpleDateFormat("yyyy-MM-dd");
 
            table.setValueAt((int)gt.getGiatien(), i, 0);
            table.setValueAt(format.format(gt.getTgbd()), i, 1);
            table.setValueAt(format.format(gt.getTgkt()), i, 2);
            
            jt.setModel(table);
        }
        
    }//GEN-LAST:event_jButton6MouseClicked

    private void jButton7MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jButton7MouseClicked
        // TODO add your handling code here:
        int i = jt.getSelectedRow();
        if(i>=0)
        {
            arrayGia.remove(i);
            table.removeRow(i);
            jt.setModel(table);
            
        }
    }//GEN-LAST:event_jButton7MouseClicked

    private void jtAllDDMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jtAllDDMouseClicked
        // TODO add your handling code here:
        
    }//GEN-LAST:event_jtAllDDMouseClicked

    private void btnAddMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnAddMouseClicked
        try {
            // TODO add your handling code here:
            int i = jtAllDD.getSelectedRow();
            DiaDiemBUS bus = new DiaDiemBUS();
            bus.docDuLieu();
            if(i >= 0)
            {
                DTO.DiaDiem dd = bus.getDiaDiem(jtAllDD.getValueAt(i, 0).toString());
                arrayDiaDiem.add(dd);
                Vector vt = new Vector();
                vt.add(dd.getTendiadiem());
                tableChosenDD.addRow(vt);
                jtChosenDD.setModel(tableChosenDD);
            }
        } catch (Exception ex) {
            Logger.getLogger(ChinhSuaTour.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_btnAddMouseClicked

    private void btnRemoveMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnRemoveMouseClicked
        // TODO add your handling code here:
            int i = jtChosenDD.getSelectedRow();
            if(i >= 0)
            {
                arrayDiaDiem.remove(i);
                tableChosenDD.removeRow(i);
                jtChosenDD.setModel(tableChosenDD);
                if(jtChosenDD.getRowCount() > 0)
                    try{
                        jtChosenDD.setRowSelectionInterval(i,i);
                    }catch (Exception e)
                    {
                            jtChosenDD.setRowSelectionInterval(i-1,i-1);
                    }
            }
    }//GEN-LAST:event_btnRemoveMouseClicked

    private void cbLoaiTourActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbLoaiTourActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cbLoaiTourActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(ChinhSuaTour.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(ChinhSuaTour.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(ChinhSuaTour.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(ChinhSuaTour.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new ChinhSuaTour(1).setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAdd;
    private javax.swing.JButton btnRemove;
    public javax.swing.JComboBox<String> cbLoaiTour;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton5;
    private javax.swing.JButton jButton6;
    private javax.swing.JButton jButton7;
    private javax.swing.JDialog jDialog1;
    private javax.swing.JDialog jDialog2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private com.toedter.calendar.JDateChooser jdcEnd;
    private com.toedter.calendar.JDateChooser jdcStart;
    private javax.swing.JTable jt;
    private javax.swing.JTable jtAllDD;
    private javax.swing.JTable jtChosenDD;
    private javax.swing.JLabel lblMaLoaiTour;
    private javax.swing.JLabel lblMaTour;
    private javax.swing.JLabel lblTenTour;
    private javax.swing.JPanel pInputTour;
    private javax.swing.JTextField txtGia;
    public javax.swing.JTextField txtMaTour;
    public javax.swing.JTextField txtTenTour;
    // End of variables declaration//GEN-END:variables
    public void hienThiDuLieuTour(int matour)
    {
        txtMaTour.setText(matour+"");
        TourBUS tbus = new TourBUS();
        LoaiTourBUS ltbus = new LoaiTourBUS();
        DTO.Tour tour;
        try {
            ltbus.docDuLieu();
            ArrayList<DTO.LoaiTour> arrayListLoaiTour = ltbus.ds;
            Vector vector = new Vector();
            for(DTO.LoaiTour lt : arrayListLoaiTour)
            {
                vector.add(lt.getTenloaitour());
            }
            cbLoaiTour.setModel(new DefaultComboBoxModel(vector));
            tour = tbus.find(matour);
            txtTenTour.setText(tour.getTentour());
            cbLoaiTour.setSelectedItem(ltbus.getTenLoaiTour(tour.getMaloaitour()));
            
        } catch (Exception ex) {
            Logger.getLogger(ChinhSuaTour.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
    public void doDuLieuBangGia(int matour)
    {
        GiaTourBUS bus = new GiaTourBUS();
        try {
            bus.docDuLieu();
            arrayGia = new ArrayList(bus.getDSGia(matour));
            
            table = (DefaultTableModel) jt.getModel();
            table.setRowCount(0);
            for(DTO.GiaTour gt : arrayGia)
            {
                Vector vt = new Vector();
                vt.add((int)gt.getGiatien());
                vt.add(gt.getTgbd());
                vt.add(gt.getTgkt());
                table.addRow(vt);
            }
            jt.setModel(table);
        } catch (Exception ex) {
            Logger.getLogger(Tour.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

        private void setTextFields(String gia, String ngaybd, String ngaykt) {
        txtGia.setText(gia);
        try {
            DateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
            jdcStart.setDate(dateFormat.parse(ngaybd));
            jdcEnd.setDate(dateFormat.parse(ngaykt));
        } catch (ParseException ex) {
            Logger.getLogger(GiaTour.class.getName()).log(Level.SEVERE, null, ex);
        }
        
    }

    private void doDuLieuLenBangTatCaDD() {
        
        DiaDiemBUS ddbus = new DiaDiemBUS();
        try {
            ddbus.docDuLieu();
            tableAllDD = (DefaultTableModel) jtAllDD.getModel();
            tableAllDD.setRowCount(0);
            for(DTO.DiaDiem dd: ddbus.ds)
            {
                Vector vt = new Vector();
                vt.add(dd.getTendiadiem());
                tableAllDD.addRow(vt);
            }
            jtAllDD.setModel(tableAllDD);
        } catch (Exception ex) {
            Logger.getLogger(ChinhSuaTour.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    private void doDuLieuLenBangDiaDiemDaChon(int mt) {
        ChiTietTourBUS cttbus = new ChiTietTourBUS();
        DiaDiemBUS ddbus = new DiaDiemBUS();
        arrayDiaDiem = new ArrayList<DTO.DiaDiem>();
        try {
            cttbus.docDuLieu();
            ddbus.docDuLieu();
            tableChosenDD = (DefaultTableModel) jtChosenDD.getModel();
            tableChosenDD.setRowCount(0);
            
            for(DTO.ChiTietTour ctt: cttbus.getChiTietTourTheoMatour(mt))
            {
                DTO.DiaDiem dd = ddbus.getDiaDiem(ctt.getMadiadiem());
                arrayDiaDiem.add(dd);
                Vector vt = new Vector();
                vt.add(dd.getTendiadiem());
                tableChosenDD.addRow(vt); 
            }
            jtChosenDD.setModel(tableChosenDD);
        } catch (Exception ex) {
            Logger.getLogger(ChinhSuaTour.class.getName()).log(Level.SEVERE, null, ex);
        }
    }
}
